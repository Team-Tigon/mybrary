<p id="notice" style="text-align: center;"><%= notice %></p>

<% if @user != current_user %>
  <h3><%= @user.name %></h3>
<% end %>

  <div class="tabbable">
    <ul id="myTab" class="nav nav-tabs">
      <li class="active"><a href="#tab1" data-toggle="tab">Tab 1</a></li>
      <li class=""><a href="#tab2" data-toggle="tab">Tab 2</a></li>
      <li class=""><a href="#tab3" data-toggle="tab">Tab 3</a></li>
    </ul>
    <div id="myTabContent" class="tab-content">
      <div class="tab-pane fade active in" id="tab1">
        <p>Dignissim tincidunt mattis lorem, sagittis nisi, amet ut pulvinar lectus cursus ac! Enim turpis odio dis. Non ut vel, nisi dapibus? Velit augue tortor, ut ac ac nec tortor nec, mauris massa.</p>
      </div>              
      <div class="tab-pane fade" id="tab2">
        <p>Aliquet risus, penatibus, ac integer ultricies ultricies elementum augue proin habitasse placerat. Nunc habitasse duis, elementum, porttitor porta? Purus, ac odio. Habitasse, egestas vut.</p>
      </div>
      <div class="tab-pane fade" id="tab3">
        <p>Turpis elit, egestas nec etiam! Porta parturient amet! Eros aenean sit lacus sagittis massa? Massa a nunc! Nisi vut! Lundium, dictumst, nunc enim, natoque, cras nec, dictumst et rhoncus!</p>
      </div>
    </div>
  </div>

<div class="row">
  <div class="col-md-12">

    <div class="user-header">
      <% if @user != current_user %>
        <h3 class="navbar-left"><%= @user.name %></h3>
      <% else %>
        <h3 class="navbar-left">Your Profile</h3>
        <h3 class="navbar-right">
          <%= link_to 'Add New Item', new_user_item_path(@user), :class => "btn btn-primary" %>
        </h3>
      <% end %>
    </div>

    <br>
    <br>

    <h4 class="margin-top-large">Owned Items (Requested: <%= @user.my_requested_items.size %> / 
      Lent out: <%= @user.my_loaned_items.size %> / 
      Available Items: <%= @user.my_available_items.size %>)
    </h4>


    <table class="table table-striped table-hover table-condensed table-outliner">
      <thead>
        <tr>
          <th>Title</th>
          <th>Type</th>
          <th>Status</th>
          <th>Other User</th>
          <th>Date</th>
          <th></th>
        </tr>
      </thead>
      <tbody>
        <% @user.my_requested_items.each do |item| %>
          <tr>
            <td><%= link_to item.name, user_item_path(@user.id, item.id) %></td>
            <td><%= item.type_list.last %></td>
            <td>Requested</td>
            <td><% if current_user == @user || current_user == item.loans.last.user %> <!-- hides names that are not the user's -->
              by <%= link_to item.loans.last.user.name, user_path(item.loans.last.user) %>
              <% end %>
            </td>
            <td>on <%= item.loans.last.created_at.strftime("%h %d") %></td>
    <!-- Loops the <td> line so that both buttons fit on one line -->
            <% if current_user == @user %>
              <td style="width: 110px;">
              <%= button_to "Given", approve_loan_path(@user.id, item.id), class: "btn btn-success btn-xs btn-inline" %>
              <%= button_to "Deny", deny_loan_path(@user.id, item.id), class: "btn btn-danger btn-xs btn-inline" %>
            <% elsif current_user == item.loans.last.user %>
              <td>
              <%= button_to "Cancel", deny_loan_path(@user.id, item.id), class: "btn btn-warning btn-xs btn-inline" %>
            <% else %>
            <td>
            <% end %>
            </td>
    <!-- Ends loop -->
          </tr>
        <% end %>
        <% @user.my_loaned_items.each do |item| %>
          <tr>
            <td><%= link_to item.name, user_item_path(@user.id, item.id) %></td>
            <td><%= item.type_list.last %></td>
            <td>Lent out</td>
            <td><% if current_user == @user || current_user == item.loans.last.user %> <!-- hides names that are not the user's -->
              to <%= link_to item.loans.last.user.name, item.loans.last.user %>
              <% end %>
            </td>
            <td>on <%= item.loans.last.created_at.strftime("%h %d") %></td>
            <td><% if current_user == @user %>
              <%= button_to "Returned", return_loan_path(@user.id, item.id), data: { confirm: 'Are you sure? This marks your item as Available again and cannot be undone.' }, class: "btn btn-primary btn-xs btn-inline" %>
              <% end %>
            </td>
          </tr>
        <% end %>
        <% @user.my_available_items.each do |item| %>
          <tr>
            <td><%= link_to item.name, user_item_path(@user.id, item.id) %></td>
            <td><%= item.type_list.last %></td>
            <td>Available</td>
            <td></td>
            <td></td>
            <td><% if current_user && current_user != @user %>
              <%= button_to "Request", request_loan_path(current_user, item.id), :class => "btn btn-primary btn-xs" %> 
              <% end %>
            </td>
          </tr>
        <% end %>
      </tbody>
    </table>

    <br>
    <% if @user != current_user %>
      <h4>Borrowing Items  (Total borrowing: <%= @user.currently_borrowing.size %> / Total waiting: <%= @user.currently_requesting.size %>)</h4>
    <% else %>
    <h4 class="margin-top-large">Borrowing Items  (Total borrowing: <%= @user.currently_borrowing.size %> / 
        Total waiting: <%= @user.currently_requesting.size %>)
    </h4>

      <table class="table table-striped table-hover table-condensed table-outliner">
        <thead>
          <tr>
            <th>Title</th>
            <th>Type</th>
            <th>Status</th>
            <th>Other User</th>
            <th>Date</th>
            <th></th>
          </tr>
        </thead>
        <tbody>
          <% @user.currently_borrowing.each do |loan|%>
            <tr>
              <td><%= link_to loan.item.name, user_item_path(loan.item.user_id, loan.item_id) %></td>
              <td><%= loan.item.type_list.last %></td>
              <td>Borrowing</td>
              <td>from <%= link_to loan.item.user.name, loan.item.user %></td>
              <td>since <%= loan.created_at.strftime("%h %d") %></td>
              <td></td>
            </tr>
          <% end %>
          <% @user.currently_requesting.each do |loan|%>
            <tr>
              <td><%= link_to loan.item.name, user_item_path(loan.user.id, loan.item.id) %></td>
              <td><%= loan.item.type_list.last %></td>
              <td>Waiting for loan</td>
              <td>from <%= link_to loan.item.user.name, user_path(loan.item.user) %></td>
              <td>since <%= loan.created_at.strftime("%h %d") %></td>
              <td><% if current_user == @user %>
                <%= button_to "Cancel", deny_loan_path(loan.user.id, loan.item.id), class: "btn btn-warning btn-xs btn-inline" %>
                <% end %>
              </td>
            </tr>
          <% end %>
        </tbody>
      </table>
    <% end %>


    <h4><br>
      Groups (<%= @user.groups.size %>)
      <% @user.groups.each do |g|%>
        <li><%= link_to g.name, g %></li>
      <% end %>
    </h4>

  </div>
</div>
